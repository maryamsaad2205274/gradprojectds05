{% extends "base.html" %}
{% block title %}Patients{% endblock %}

{% block content %}

<div class="p-head">
  <div>
    <h1 class="p-title">Patients</h1>
    <p class="p-sub">View your patients and their cases.</p>
  </div>

  <form class="p-search" method="GET" action="{{ url_for('patients') }}">
    <div class="p-search__group">
      <input class="input" type="text" name="q" value="{{ q }}" placeholder="Search patient codeâ€¦">
      <button class="btn btn--primary" type="submit">Search</button>
    </div>
  </form>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="messages">
      {% for category, msg in messages %}
        <div class="msg {{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<div class="panel">
  <div class="panel__head p-panel-head">
    <div>
      <h2 class="panel__title">Patient List</h2>
      <p class="panel__sub">All patients linked to your account.</p>
    </div>

    <div class="p-count">
      {{ patients|length if patients else 0 }} Patients
    </div>
  </div>

  {% if patients and patients|length > 0 %}
  <div class="p-table">

    <div class="p-table__head">
      <div>Code</div>
      <div>Name</div>
      <div>Age</div>
      <div>Gender</div>
      <div>Created</div>
    </div>

    {% for p in patients %}
      <div class="p-table__row">
        <div class="t-strong">{{ p.patient_code }}</div>
        <div class="t-muted">{{ p.name or "-" }}</div>
        <div class="t-muted">{{ p.age or "-" }}</div>
        <div class="t-muted">{{ p.gender or "-" }}</div>
        <div class="t-muted">{{ p.created_at.strftime("%Y-%m-%d") }}</div>
        <div class="t-right">
          <a class="btn btn--ghost btn--small"
             href="{{ url_for('patient_cases', patient_id=p.id) }}">
            View Cases
          </a>
        </div>
      </div>
    {% endfor %}

  </div>
{% else %}

    <div class="empty">
      <div class="empty__title">No patients yet</div>
      <div class="empty__text">Add a patient from New Analysis to start.</div>
      <a class="btn btn--primary btn--small" href="{{ url_for('new_analysis') }}">+ New Analysis</a>
    </div>
  {% endif %}
</div>

{% endblock %}
