{% extends "base.html" %}
{% block title %}Patients{% endblock %}

{% block content %}

<div class="p-head">
  <div>
    <h1 class="p-title">Patients</h1>
    <p class="p-sub">Manage your patients and start cases faster.</p>
  </div>

  <form class="p-search" method="GET" action="{{ url_for('patients') }}">
    <input class="input" type="text" name="q" value="{{ q }}" placeholder="Search patient code…">
    <button class="btn btn--ghost" type="submit">Search</button>
  </form>
</div>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="messages">
      {% for category, msg in messages %}
        <div class="msg {{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<div class="p-grid">

  <!-- Add patient -->
<div class="panel">
  <div class="panel__head">
    <div>
      <h2 class="panel__title">Add Patient</h2>
      <p class="panel__sub">Create a patient record using a code.</p>
    </div>
  </div>

  <form method="POST" action="{{ url_for('patients') }}">

    <div class="field">
      <label>Patient Code</label>
      <input
  class="input"
  type="number"
  name="patient_code"
  placeholder="e.g., 014"
  required
  min="1"
  step="1"
>

    </div>

    <div class="row2">
      <div class="field">
        <label>Age (optional)</label>
        <input
          class="input"
          type="number"
          name="age"
          min="1"
          max="119"
          placeholder="e.g., 21"
        >
      </div>

      <div class="field">
        <label>Gender (optional)</label>
        <select class="input" name="gender">
          <option value="">—</option>
          <option value="MALE">Male</option>
          <option value="FEMALE">Female</option>
        </select>
      </div>
    </div>

    <div class="p-actions">
      <button class="btn btn--primary" type="submit">
        Add Patient
      </button>
    </div>

  </form>
</div>



  <!-- Patients list -->
  <div class="panel">
    <div class="panel__head">
      <div>
        <h2 class="panel__title">Patient List</h2>
        <p class="panel__sub">Click a patient to view their cases.</p>
      </div>
    </div>

    {% if patients and patients|length > 0 %}
      <div class="table">
        <div class="table__head">
          <div>Patient Code</div>
          <div>Created</div>
          <div class="t-right">Action</div>
        </div>

        {% for p in patients %}
          <div class="table__row">
            <div class="t-strong">{{ p.patient_code }}</div>
            <div class="t-muted">{{ p.created_at.strftime("%Y-%m-%d") }}</div>
            <div class="t-right">
              <a class="btn btn--ghost btn--small" href="{{ url_for('patient_cases', patient_id=p.id) }}">View Cases</a>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty">
        <div class="empty__title">No patients yet</div>
        <div class="empty__text">Add a patient to start organizing cases by patient code.</div>
      </div>
    {% endif %}

  </div>

</div>

{% endblock %}
